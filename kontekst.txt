# KONTEKS APLIKACJI ASSETHUB - PRZEWODNIK DLA GENERATOR√ìW AI

## ARCHITEKTURA I KONWENCJE

### Struktura aplikacji
- **Framework**: Symfony 7.0 + PHP 8.2+
- **Baza danych**: MySQL/MariaDB z Doctrine ORM
- **Frontend**: Bootstrap 5.3 + Twig templates + vanilla JavaScript
- **Autoryzacja**: Custom role-based system z modu≈Çami
- **Logowanie**: Monolog z wieloma kana≈Çami

### Konwencje nazewnictwa
- **Kontrolery**: `{Module}Controller` (np. EquipmentController)
- **Encje**: Singular form (User, Equipment, Module)
- **Repozytoria**: `{Entity}Repository`
- **Formularze**: `{Purpose}Type` (np. EquipmentCreateType)
- **Us≈Çugi**: `{Purpose}Service` (np. PermissionService)
- **Szablony**: `{module}/{action}.html.twig`

## SYSTEM MODU≈ÅOWY

### Jak dzia≈Ça system modu≈Ç√≥w
1. Ka≈ºdy modu≈Ç ma wpis w tabeli `modules` (nazwa, opis, czy aktywny)
2. Role sƒÖ przypisane do modu≈Ç√≥w w tabeli `roles`
3. U≈ºytkownicy majƒÖ role przez tabelƒô `user_roles`
4. Ka≈ºdy kontroler sprawdza uprawnienia przez `PermissionService`

### Dodawanie nowego modu≈Çu - CHECKLIST:

#### 1. BAZA DANYCH
```sql
-- Dodaj modu≈Ç do tabeli modules
INSERT INTO modules (name, display_name, description, is_active, sort_order) 
VALUES ('new_module', 'Nowy Modu≈Ç', 'Opis nowego modu≈Çu', 1, 100);

-- Dodaj podstawowe role
INSERT INTO roles (name, display_name, description, permissions, module_id) VALUES
('NEW_MODULE_ADMIN', 'Administrator Nowego Modu≈Çu', 'Pe≈Çny dostƒôp', 'VIEW,CREATE,EDIT,DELETE', (SELECT id FROM modules WHERE name = 'new_module')),
('NEW_MODULE_USER', 'U≈ºytkownik Nowego Modu≈Çu', 'Tylko podglƒÖd', 'VIEW', (SELECT id FROM modules WHERE name = 'new_module'));
```

#### 2. ENCJE (src/Entity/)
- Dodaj `createdAt`, `updatedAt` dla auditowania
- Dodaj relacje do `User` (created_by, updated_by)
- U≈ºyj Doctrine annotations/attributes
- Dodaj indeksy dla czƒôsto wyszukiwanych p√≥l

#### 3. REPOZYTORIA (src/Repository/)
- Rozszerz `ServiceEntityRepository`
- Dodaj metodƒô `save($entity, bool $flush = false)`
- Dodaj metody wyszukiwania specyficzne dla modu≈Çu

#### 4. KONTROLERY (src/Controller/)
- U≈ºyj `#[Route('/module-path')]` na klasie
- ZAWSZE sprawd≈∫ uprawnienia przez `PermissionService`
- ZAWSZE loguj operacje przez `LoggerInterface`
- U≈ºyj Flash messages dla informacji zwrotnych

#### 5. FORMULARZE (src/Form/)
- U≈ºyj Bootstrap classes: `form-control`, `form-select`
- Dodaj walidacjƒô Symfony Constraints
- U≈ºyj `required: false` dla opcjonalnych p√≥l

#### 6. US≈ÅUGI (src/Service/)
- Logika biznesowa oddzielona od kontroler√≥w
- U≈ºywaj dependency injection
- Loguj wszystkie wa≈ºne operacje

#### 7. SZABLONY (templates/)
```
templates/
‚îú‚îÄ‚îÄ module_name/
‚îÇ   ‚îú‚îÄ‚îÄ index.html.twig
‚îÇ   ‚îú‚îÄ‚îÄ show.html.twig
‚îÇ   ‚îú‚îÄ‚îÄ edit.html.twig
‚îÇ   ‚îî‚îÄ‚îÄ _form.html.twig
```

#### 8. NAVIGATION (templates/partials/sidebar.html.twig)
```twig
{% if is_granted_module('module_name') %}
<li class="nav-item">
    <a class="nav-link menu-link" href="{{ path('module_index') }}">
        <i class="ri-icon-name"></i>
        <span>Nazwa Modu≈Çu</span>
    </a>
</li>
{% endif %}
```

## SYSTEM LOGOWANIA

### OBOWIƒÑZKOWE LOGOWANIE
Ka≈ºdy kontroler MUSI logowaƒá:
```php
// Dostƒôp do modu≈Çu
$this->logger->info('Module accessed', [
    'module' => 'module_name',
    'user' => $user->getUsername(),
    'ip' => $this->getClientIp()
]);

// Operacje CRUD
$this->logger->info('Entity created/updated/deleted', [
    'entity' => 'EntityName',
    'id' => $entity->getId(),
    'user' => $user->getUsername(),
    'ip' => $this->getClientIp()
]);

// B≈Çƒôdy i ostrze≈ºenia
$this->logger->error('Operation failed', [
    'operation' => 'operation_name',
    'error' => $e->getMessage(),
    'user' => $user->getUsername(),
    'ip' => $this->getClientIp()
]);
```

### Kana≈Çy logowania
- `app` - g≈Ç√≥wne operacje aplikacji
- `security` - bezpiecze≈Ñstwo i uwierzytelnianie
- `equipment` - operacje na sprzƒôcie
- `dictionary` - operacje na s≈Çownikach
- `{module_name}` - dedykowany kana≈Ç dla modu≈Çu

## SYSTEM UPRAWNIE≈É

### Sprawdzanie uprawnie≈Ñ
```php
// W kontrolerze - ZAWSZE na poczƒÖtku akcji
if (!$this->permissionService->hasPermission($user, 'module_name', 'PERMISSION_NAME')) {
    $this->logger->warning('Unauthorized access attempt', [
        'module' => 'module_name',
        'user' => $user?->getUsername() ?? 'anonymous',
        'ip' => $request->getClientIp()
    ]);
    return $this->redirectToRoute('error_access_denied');
}

// W szablonach - sprawdzanie r√≥l w module admin
{% set userModules = get_user_modules() %}
{% set hasSystemAdmin = false %}
{% set hasEmployeesRole = false %}

{% for userRole in userModules %}
    {% set module = userRole.role.module %}
    
    {% if module.name == 'admin' and userRole.role.name == 'system_admin' %}
        {% set hasSystemAdmin = true %}
    {% elseif module.name == 'admin' and userRole.role.name in ['employees_viewer', 'employees_editor', 'employees_manager'] %}
        {% set hasEmployeesRole = true %}
    {% endif %}
{% endfor %}

{# Panel administracyjny dla system_admin #}
{% if hasSystemAdmin %}
    <!-- admin panel content -->
{% endif %}

{# Menu Pracownicy dla system_admin lub r√≥l employees #}
{% if hasSystemAdmin or hasEmployeesRole %}
    <!-- employees menu -->
{% endif %}
```

### Typy uprawnie≈Ñ w module admin
- **system_admin** - pe≈Çny dostƒôp do panelu administracyjnego
- **employees_viewer** - `EMPLOYEES_VIEW` - tylko podglƒÖd pracownik√≥w
- **employees_editor** - `EMPLOYEES_EDIT_BASIC` - edycja podstawowych danych pracownik√≥w
- **employees_manager** - `EMPLOYEES_EDIT_FULL` - pe≈Çne zarzƒÖdzanie pracownikami (tworzenie, usuwanie, role)

### Kontrola dostƒôpu w kontrolerach pracownik√≥w
```php
// PodglƒÖd pracownik√≥w - wystarczy jeden z trzech uprawnie≈Ñ
if (!$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_VIEW') && 
    !$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_BASIC') && 
    !$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_FULL')) {
    return $this->redirectToRoute('error_access_denied');
}

// Edycja pracownik√≥w - wystarczy jedno z dw√≥ch uprawnie≈Ñ edycji
if (!$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_BASIC') && 
    !$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_FULL')) {
    return $this->redirectToRoute('error_access_denied');
}

// Pe≈Çne zarzƒÖdzanie - tylko EMPLOYEES_EDIT_FULL
if (!$this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_FULL')) {
    return $this->redirectToRoute('error_access_denied');
}

// Przekazywanie uprawnie≈Ñ do szablonu
$canEdit = $this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_BASIC') || 
           $this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_FULL');
$canEditFull = $this->permissionService->hasPermission($user, 'admin', 'EMPLOYEES_EDIT_FULL');

return $this->render('template.html.twig', [
    'can_edit' => $canEdit,
    'can_edit_full' => $canEditFull,
]);
```

## BAZA DANYCH - FIXTURES

### Aktualizacja fixtures (src/DataFixtures/)
Przy dodawaniu nowego modu≈Çu ZAWSZE zaktualizuj:

1. **ModuleFixtures.php** - dodaj nowy modu≈Ç
2. **RoleFixtures.php** - dodaj role dla modu≈Çu  
3. **UserRoleFixtures.php** - przypisz role u≈ºytkownikom
4. **{Module}Fixtures.php** - przyk≈Çadowe dane dla modu≈Çu

## FRONTEND

### Bootstrap 5.3 classes
- Cards: `card`, `card-header`, `card-body`
- Forms: `form-control`, `form-select`, `form-check-input`
- Buttons: `btn btn-primary`, `btn btn-outline-secondary`
- Tables: `table table-striped table-hover`
- Alerts: `alert alert-success/danger/warning/info`

### JavaScript
- U≈ºywaj vanilla JavaScript (bez jQuery)
- Umie≈õƒá w `{% block javascripts %}`
- U≈ºywaj `DOMContentLoaded` event listener

### Ikony
- Remix Icons: `ri-{name}-line` lub `ri-{name}-fill`
- Przyk≈Çady: `ri-settings-line`, `ri-user-line`, `ri-delete-bin-line`

## BEZPIECZE≈ÉSTWO

### CSRF Protection
- Formularze automatycznie chronione przez Symfony
- API endpoints u≈ºywajƒÖ token√≥w

### Walidacja danych
- U≈ºywaj Symfony Constraints w formularzach
- Waliduj r√≥wnie≈º w encjach
- Sanityzuj dane wej≈õciowe

### Logowanie b≈Çƒôd√≥w bezpiecze≈Ñstwa
```php
$this->logger->warning('Security violation', [
    'type' => 'unauthorized_access',
    'user' => $user?->getUsername() ?? 'anonymous',
    'ip' => $this->getClientIp(),
    'attempted_resource' => 'resource_name'
]);
```

## MIGRACJE

### Przy dodawaniu nowego modu≈Çu
```bash
# Utw√≥rz migracjƒô
php bin/console make:migration

# Sprawd≈∫ migracjƒô
php bin/console doctrine:migrations:migrate --dry-run

# Wykonaj migracjƒô
php bin/console doctrine:migrations:migrate
```

## TESTY

### Struktura test√≥w
```
tests/
‚îú‚îÄ‚îÄ Controller/
‚îÇ   ‚îî‚îÄ‚îÄ {Module}ControllerTest.php
‚îú‚îÄ‚îÄ Entity/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}Test.php
‚îî‚îÄ‚îÄ Service/
    ‚îî‚îÄ‚îÄ {Service}Test.php
```

## PRZYK≈ÅAD KOMPLETNEGO MODU≈ÅU

### 1. Encja (src/Entity/Example.php)
```php
#[ORM\Entity(repositoryClass: ExampleRepository::class)]
class Example
{
    #[ORM\Id, ORM\GeneratedValue, ORM\Column]
    private ?int $id = null;

    #[ORM\Column(length: 255)]
    private ?string $name = null;

    #[ORM\Column(type: Types::DATETIME_IMMUTABLE)]
    private ?\DateTimeImmutable $createdAt = null;

    #[ORM\ManyToOne]
    private ?User $createdBy = null;

    // getters, setters...
}
```

### 2. Kontroler (src/Controller/ExampleController.php)
```php
#[Route('/example')]
class ExampleController extends AbstractController
{
    public function __construct(
        private PermissionService $permissionService,
        private LoggerInterface $logger
    ) {}

    #[Route('/', name: 'example_index')]
    public function index(): Response
    {
        $user = $this->getUser();
        
        if (!$this->permissionService->canAccessModule($user, 'example')) {
            $this->logger->warning('Unauthorized example access', [
                'user' => $user?->getUsername() ?? 'anonymous',
                'ip' => $this->getClientIp()
            ]);
            throw $this->createAccessDeniedException();
        }

        $this->logger->info('Example module accessed', [
            'user' => $user->getUsername(),
            'ip' => $this->getClientIp()
        ]);

        return $this->render('example/index.html.twig');
    }
}
```

## INSTALATOR - AKTUALIZACJA

### Przy dodawaniu modu≈Çu zaktualizuj:
1. **InstallController.php** - dodaj modu≈Ç do kreatora
2. **install/step3.html.twig** - opcja instalacji przyk≈Çadowych danych
3. **{Module}Fixtures.php** - przyk≈Çadowe dane dla kreatora

## KONFIGURACJA SYSTEMU

### Dodaj ustawienia do SettingService je≈õli modu≈Ç wymaga konfiguracji
```php
$this->settingService->set('module_setting', 'value', 'module', 'type', 'description');
```

### System dynamicznego CSS (DynamicCssController)
```php
// Pobieranie ustawie≈Ñ kolor√≥w
$primaryColor = $this->settingService->get('primary_color', '#405189');
$sidebarBgColor = $this->settingService->get('sidebar_bg_color', '#2a3042');
$sidebarTextColor = $this->settingService->get('sidebar_text_color', '#ffffff');
$sidebarActiveColor = $this->settingService->get('sidebar_active_color', '#405189');

// Generowanie CSS z ETag caching
$etag = md5($primaryColor . $sidebarBgColor . $sidebarTextColor . $sidebarActiveColor);
$response->setEtag($etag);
$response->setMaxAge(60); // 1 minuta cache
```

#### CSS Variables + Direct Selectors Pattern
```css
/* Podw√≥jne podej≈õcie dla kompatybilno≈õci */
:root, :root[data-sidebar=light], :root[data-sidebar=dark] {
    --vz-vertical-menu-item-color: {$sidebarTextColor} !important;
    --vz-vertical-menu-item-active-color: {$sidebarTextColor} !important;
}

/* Direct selectors dla wysokiej specyficzno≈õci */
.navbar-menu .navbar-nav .nav-link.active {
    background-color: {$sidebarActiveColor} !important;
    color: {$sidebarTextColor} !important;
}
```

## S≈ÅOWNIKI SYSTEMOWE

### Je≈õli modu≈Ç u≈ºywa s≈Çownik√≥w, dodaj typy do DictionaryFixtures:
```php
$categoryType = new Dictionary();
$categoryType->setType('example_categories');
$categoryType->setKey('active');
$categoryType->setValue('Aktywny');
```

## SYSTEM PROFILI U≈ªYTKOWNIK√ìW

### Funkcjonalno≈õci profili
- **Edycja danych osobowych** - imiƒô, nazwisko, email, telefon, stanowisko, dzia≈Ç, oddzia≈Ç
- **Zmiana has≈Ça** - dla u≈ºytkownik√≥w lokalnych (nie LDAP)
- **Upload avatar√≥w** - JPG, PNG, GIF, WebP (max 2MB), przechowywane w `public/uploads/avatars/`
- **Integracja LDAP** - synchronizacja danych z Active Directory

### Pattern Upload√≥w Avatar√≥w
```php
// Walidacja upload√≥w
new File([
    'maxSize' => '2M',
    'mimeTypes' => ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
    'mimeTypesMessage' => 'Proszƒô wybraƒá prawid≈Çowy plik obrazu (JPG, PNG, GIF, WebP)',
])

// Upload i cleanup
if ($avatarFile = $form->get('avatar')->getData()) {
    // Usu≈Ñ stary avatar
    $oldAvatar = $user->getAvatar();
    if ($oldAvatar && file_exists($avatarPath . '/' . $oldAvatar)) {
        unlink($avatarPath . '/' . $oldAvatar);
    }
    
    // Zapisz nowy
    $fileName = 'avatar_' . $user->getId() . '_avatar.' . $avatarFile->guessExtension();
    $avatarFile->move($avatarPath, $fileName);
    $user->setAvatar($fileName);
}
```

## SYSTEM ZARZƒÑDZANIA BAZƒÑ DANYCH

### Funkcjonalno≈õci zarzƒÖdzania bazƒÖ
- **üìä Informacje o bazie** - rozmiar, liczba tabel, wersja, szczeg√≥≈Çowe statystyki tabel
- **üíæ Kopie zapasowe** - automatyczne backupy przez mysqldump, lista i pobieranie backup√≥w
- **‚ö° Optymalizacja** - OPTIMIZE TABLE dla wszystkich tabel MySQL
- **üîç Analiza** - ANALYZE TABLE dla aktualizacji statystyk indeks√≥w  
- **üßπ Czyszczenie log√≥w** - usuwanie starych plik√≥w log√≥w (>30 dni)
- **üìã Monitoring** - szczeg√≥≈Çowe informacje o tabelach (rozmiar danych/indeks√≥w, liczba wierszy)

### Lokalizacja i dostƒôp
- **Route**: `/admin/settings/database`
- **Uprawnienia**: tylko rola `system_admin`
- **Katalog backup√≥w**: `var/backups/` (automatycznie tworzony)
- **Format backup√≥w**: `backup_[database]_[YYYY-mm-dd_HH-ii-ss].sql`

### Bezpiecze≈Ñstwo backup√≥w
```php
// Parsing DATABASE_URL z obs≈ÇugƒÖ parametr√≥w
if (preg_match('/mysql:\/\/([^:]+):([^@]+)@([^:]+):?(\d+)?\/([^?]+)(?:\?.*)?/', $databaseUrl, $matches)) {
    $database = $matches[5]; // Ignoruje parametry po znaku ?
}

// Komenda mysqldump z bezpiecznym escapowaniem
$command = sprintf(
    'mysqldump -h%s -P%s -u%s -p%s --single-transaction --routines --triggers %s > %s 2>&1',
    escapeshellarg($host), escapeshellarg($port), escapeshellarg($username),
    escapeshellarg($password), escapeshellarg($database), escapeshellarg($filepath)
);
```

### Walidacja backup√≥w
```php
// Sprawdzanie rozmiaru i zawarto≈õci
if ($fileSize < 1000) { // Mniej ni≈º 1KB = prawdopodobnie b≈ÇƒÖd
    throw new \Exception('Kopia zapasowa wydaje siƒô niepe≈Çna');
}
```

### Struktura plik√≥w avatar√≥w
```bash
public/uploads/avatars/
‚îú‚îÄ‚îÄ user_1_avatar.jpg    # avatar_{user_id}_avatar.{ext}
‚îú‚îÄ‚îÄ user_2_avatar.png
‚îî‚îÄ‚îÄ default/
    ‚îî‚îÄ‚îÄ default-avatar.png  # domy≈õlny avatar je≈õli u≈ºytkownik nie ma w≈Çasnego
```

### Form avatar√≥w (src/Form/AvatarUploadType.php)
```php
->add('avatar', FileType::class, [
    'required' => false,
    'mapped' => false,
    'constraints' => [
        new File([
            'maxSize' => '2M',
            'mimeTypes' => ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
            'mimeTypesMessage' => 'Proszƒô wybraƒá prawid≈Çowy plik obrazu (JPG, PNG, GIF, WebP)',
        ])
    ],
    'attr' => [
        'accept' => '.jpg,.jpeg,.png,.gif,.webp'
    ]
])
```

### Obs≈Çuga upload√≥w w kontrolerze
```php
// Upload nowego avataru
if ($avatarFile = $form->get('avatar')->getData()) {
    // Usuniƒôcie starego avataru
    $oldAvatar = $user->getAvatar();
    if ($oldAvatar && file_exists($this->getParameter('avatars_directory') . '/' . $oldAvatar)) {
        unlink($this->getParameter('avatars_directory') . '/' . $oldAvatar);
    }
    
    // Zapisanie nowego
    $fileName = 'avatar_' . $user->getId() . '_avatar.' . $avatarFile->guessExtension();
    $avatarFile->move($this->getParameter('avatars_directory'), $fileName);
    $user->setAvatar($fileName);
}
```

### Wy≈õwietlanie avatar√≥w w szablonach
```twig
{# W topbar.html.twig #}
{% if app.user.avatar %}
    <img class="rounded-circle header-profile-user" 
         src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}" 
         alt="Avatar">
{% else %}
    <img class="rounded-circle header-profile-user" 
         src="{{ asset('assets/images/users/avatar-1.jpg') }}" 
         alt="Default Avatar">
{% endif %}
```

## MIGRACJE BAZY DANYCH

### Migracje MySQL - kompatybilno≈õƒá
**Problem**: MySQL nie obs≈Çuguje `IF NOT EXISTS` w `ALTER TABLE ADD COLUMN`

**RozwiƒÖzanie**: U≈ºyj `INFORMATION_SCHEMA` do sprawdzenia istnienia kolumn:
```php
public function up(Schema $schema): void
{
    $connection = $this->connection;
    $databaseName = $connection->getDatabase();
    
    // Sprawd≈∫ czy kolumna istnieje
    $result = $connection->fetchOne(
        "SELECT COUNT(*) FROM INFORMATION_SCHEMA.COLUMNS 
         WHERE TABLE_SCHEMA = ? AND TABLE_NAME = 'users' AND COLUMN_NAME = 'avatar'",
        [$databaseName]
    );
    if ($result == 0) {
        $this->addSql('ALTER TABLE users ADD avatar VARCHAR(255) DEFAULT NULL');
    }
}
```

### Przyk≈Çad migracji z wieloma kolumnami
```php
// Zbierz wszystkie kolumny do dodania
$columnsToAdd = [];

// Sprawd≈∫ ka≈ºdƒÖ kolumnƒô osobno
if ($this->columnNotExists('users', 'avatar', $connection, $databaseName)) {
    $columnsToAdd[] = 'ADD avatar VARCHAR(255) DEFAULT NULL';
}
if ($this->columnNotExists('users', 'branch', $connection, $databaseName)) {
    $columnsToAdd[] = 'ADD branch VARCHAR(100) DEFAULT NULL';
}

// Dodaj wszystkie kolumny jednym zapytaniem
if (!empty($columnsToAdd)) {
    $this->addSql('ALTER TABLE users ' . implode(', ', $columnsToAdd));
}
```

## KOMPATYBILNO≈öƒÜ DOCTRINE DBAL

### Problem z getName() w nowszych wersjach
**B≈ÇƒÖd**: `Attempted to call undefined method getName() of class Doctrine\DBAL\Platforms\MySQLPlatform`

**RozwiƒÖzanie**: ZastƒÖp `getName()` sprawdzaniem przez `instanceof`

```php
// B≈ÅƒòDNE (przestarza≈Çe)
if ($connection->getDatabasePlatform()->getName() !== 'mysql') {
    // ...
}

// POPRAWNE (kompatybilne z nowszymi wersjami)
private function getDatabaseTypeName($platform): string
{
    if ($platform instanceof \Doctrine\DBAL\Platforms\MySQLPlatform) {
        return 'mysql';
    } elseif ($platform instanceof \Doctrine\DBAL\Platforms\PostgreSQLPlatform) {
        return 'postgresql';
    } elseif ($platform instanceof \Doctrine\DBAL\Platforms\SQLitePlatform) {
        return 'sqlite';
    }
    
    // Fallback przy u≈ºyciu refleksji
    $reflection = new \ReflectionClass($platform);
    return strtolower(str_replace('Platform', '', $reflection->getShortName()));
}

private function isMySQLPlatform($platform): bool
{
    return $platform instanceof \Doctrine\DBAL\Platforms\MySQLPlatform;
}
```

### MySQL INFORMATION_SCHEMA - problem z kluczami
**B≈ÇƒÖd**: `Key "table_name" does not exist` (MySQL zwraca wielkie litery: `TABLE_NAME`)

**RozwiƒÖzanie**: Normalizacja kluczy z fallback
```php
// Normalizuj klucze do ma≈Çych liter
$tables = [];
foreach ($tablesResult as $row) {
    $tables[] = [
        'table_name' => $row['table_name'] ?? $row['TABLE_NAME'] ?? '',
        'table_rows' => $row['table_rows'] ?? $row['TABLE_ROWS'] ?? 0,
        // ...
    ];
}
```

## WZORCE FUNKCJONALNO≈öCI

### Reset do Domy≈õlnych Ustawie≈Ñ Pattern
```php
// Modal potwierdzenia z podglƒÖdem warto≈õci
<div class="modal-body">
    <div class="text-start bg-light p-3 rounded mb-3">
        <ul class="mb-0 list-unstyled">
            <li><strong>Nazwa aplikacji:</strong> AssetHub</li>
            <li><strong>G≈Ç√≥wny kolor:</strong> <span class="badge" style="background-color: #405189; color: white;">#405189</span></li>
            <!-- ... inne warto≈õci ... -->
        </ul>
    </div>
</div>

// Kontroler z CSRF protection i cleanup
public function resetGeneralSettings(Request $request): Response
{
    // CSRF validation
    if (!$this->isCsrfTokenValid('reset_general_settings', $request->request->get('_token'))) {
        $this->addFlash('error', 'Nieprawid≈Çowy token bezpiecze≈Ñstwa.');
        return $this->redirectToRoute('admin_settings_general');
    }
    
    // Reset warto≈õci + cleanup plik√≥w
    $defaultSettings = [
        'app_name' => 'AssetHub',
        'primary_color' => '#405189',
        // ...
    ];
    
    // Usu≈Ñ niestandardowe logo
    $currentLogo = $this->settingService->get('company_logo');
    if ($currentLogo && $currentLogo !== '/assets/images/logo-dark.png') {
        $logoPath = $this->getParameter('kernel.project_dir') . '/public' . $currentLogo;
        if (file_exists($logoPath) && strpos($currentLogo, '/uploads/logos/') !== false) {
            unlink($logoPath);
        }
    }
}
```

### Dual Color Input Pattern (Color Picker + HEX)
```javascript
// Synchronizacja dwukierunkowa
colorText.addEventListener('input', function() {
    const color = this.value;
    if (isValidHexColor(color)) {
        colorPreview.style.backgroundColor = color;
        // Sync z color picker przez wydarzenia
    }
});

// Inteligentna walidacja HEX
function normalizeHexColor(color) {
    color = color.trim();
    if (color && !color.startsWith('#')) {
        color = '#' + color;
    }
    // Rozszerz 3 znaki do 6
    if (/^#[0-9A-Fa-f]{3}$/.test(color)) {
        color = '#' + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];
    }
    return color;
}
```

## DODATKOWE WSKAZ√ìWKI

1. **Zawsze u≈ºywaj transakcji** dla operacji na wielu tabelach
2. **Paginacja** - u≈ºyj KnpPaginatorBundle dla du≈ºych zbior√≥w danych
3. **Cache** - u≈ºywaj Symfony Cache dla czƒôsto pobieranych danych
4. **API** - je≈õli modu≈Ç ma API, u≈ºywaj ApiPlatform
5. **Eventy** - u≈ºywaj Symfony Events dla loose coupling
6. **T≈Çumaczenia** - przygotuj klucze dla Symfony Translator
7. **Pliki uploads** - zawsze sprawdzaj typ MIME i wielko≈õƒá pliku
8. **MySQL migracje** - u≈ºywaj INFORMATION_SCHEMA zamiast IF NOT EXISTS
9. **CSS Conflicts** - u≈ºyj CSS Variables + Direct Selectors z !important
10. **Color Inputs** - implementuj dual approach: picker + text field z synchronizacjƒÖ
11. **Reset Functionality** - zawsze z modalem potwierdzenia i cleanup plik√≥w
12. **Dynamic CSS** - u≈ºyj ETag caching i response headers

## DEPLOYMENT

### Checklist przed deploymentem nowego modu≈Çu:
- [ ] Migracje bazy danych przetestowane
- [ ] Fixtures zaktualizowane
- [ ] Uprawnienia skonfigurowane
- [ ] Logowanie zaimplementowane
- [ ] Testy napisane i przechodzƒÖce
- [ ] Dokumentacja zaktualizowana
- [ ] Cache wyczyszczony na produkcji

---

Ten plik s≈Çu≈ºy jako kompletny przewodnik dla generator√≥w AI przy rozwijaniu aplikacji AssetHub. Zawiera wszystkie konwencje, wzorce i wymagania niezbƒôdne do prawid≈Çowego dodawania nowych modu≈Ç√≥w.