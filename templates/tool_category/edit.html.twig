{% extends 'base.html.twig' %}

{% block title %}Edytuj {{ category.name }} - {{ app_name() }}{% endblock %}
{% block page_title %}Edytuj kategorię narzędzi{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="/">Strona główna</a></li>
    <li class="breadcrumb-item"><a href="/admin">Administracja</a></li>
    <li class="breadcrumb-item"><a href="{{ path('app_tool_index') }}">Narzędzia</a></li>
    <li class="breadcrumb-item"><a href="{{ path('app_tool_category_index') }}">Kategorie</a></li>
    <li class="breadcrumb-item"><a href="{{ path('app_tool_category_show', {id: category.id}) }}">{{ category.name }}</a></li>
    <li class="breadcrumb-item active">Edycja</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-xl-6 col-lg-8 mx-auto">
        {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
        
        <!-- Header with category info -->
        <div class="card bg-primary-subtle">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0 me-3">
                        <div class="avatar-sm">
                            <div class="avatar-title rounded-circle bg-primary text-white display-6">
                                {% if category.icon %}
                                    <i class="{{ category.icon }}"></i>
                                {% else %}
                                    <i class="bx bx-folder"></i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="card-title text-primary mb-1">Edycja: {{ category.name }}</h5>
                        <p class="text-muted mb-0">Kategoria z {{ category.activeToolsCount }} narzędziami</p>
                    </div>
                    <div class="flex-shrink-0">
                        <a href="{{ path('app_tool_category_show', {id: category.id}) }}" class="btn btn-outline-primary">
                            <i class="ri-eye-line me-1"></i> Podgląd
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="ri-folder-settings-line me-2"></i>Informacje o kategorii
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    {{ form_label(form.name, 'Nazwa kategorii', {'label_attr': {'class': 'form-label required'}}) }}
                    {{ form_widget(form.name, {'attr': {'class': 'form-control', 'placeholder': 'np. Elektronarzędzia, Narzędzia hydrauliczne'}}) }}
                    {{ form_errors(form.name) }}
                    <div class="form-text">Nazwa kategorii powinna być unikalna i opisowa.</div>
                </div>

                <div class="mb-3">
                    {{ form_label(form.description, 'Opis', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.description, {'attr': {'class': 'form-control', 'rows': 3, 'placeholder': 'Krótki opis kategorii narzędzi'}}) }}
                    {{ form_errors(form.description) }}
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="mb-3">
                            {{ form_label(form.icon, 'Ikona', {'label_attr': {'class': 'form-label'}}) }}
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i id="icon-preview" class="{{ category.icon ?: 'bx bx-folder' }}"></i>
                                </span>
                                {{ form_widget(form.icon, {'attr': {'class': 'form-control', 'placeholder': 'bx bx-wrench', 'id': 'icon-input'}}) }}
                            </div>
                            {{ form_errors(form.icon) }}
                            <div class="form-text">
                                Klasa CSS ikony z <a href="https://boxicons.com/" target="_blank">Boxicons</a> 
                                (np. <code>bx bx-wrench</code>, <code>ri-tools-line</code>)
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="mb-3">
                            {{ form_label(form.sortOrder, 'Kolejność sortowania', {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.sortOrder, {'attr': {'class': 'form-control', 'min': 0}}) }}
                            {{ form_errors(form.sortOrder) }}
                            <div class="form-text">Niższe wartości będą wyświetlane jako pierwsze.</div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        {{ form_widget(form.isActive, {'attr': {'class': 'form-check-input'}}) }}
                        {{ form_label(form.isActive, 'Kategoria aktywna', {'label_attr': {'class': 'form-check-label'}}) }}
                        {{ form_errors(form.isActive) }}
                        <div class="form-text">Tylko aktywne kategorie będą dostępne przy tworzeniu narzędzi.</div>
                    </div>
                </div>

                {% if not category.isActive %}
                <div class="alert alert-warning">
                    <i class="ri-error-warning-line me-2"></i>
                    <strong>Uwaga!</strong> Ta kategoria jest nieaktywna i nie będzie wyświetlana przy tworzeniu nowych narzędzi.
                </div>
                {% endif %}

                {% if category.activeToolsCount > 0 and not form.isActive.vars.data %}
                <div class="alert alert-info">
                    <i class="ri-information-line me-2"></i>
                    <strong>Informacja:</strong> Ta kategoria zawiera {{ category.activeToolsCount }} aktywnych narzędzi. 
                    Dezaktywacja kategorii nie wpłynie na istniejące narzędzia.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Icon Gallery -->
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="ri-palette-line me-2"></i>Popularne ikony
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-2" id="icon-gallery">
                    <!-- Popular tool-related icons -->
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-wrench" title="Klucz">
                            <i class="bx bx-wrench"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-cog" title="Koło zębate">
                            <i class="bx bx-cog"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-hammer" title="Młotek">
                            <i class="bx bx-hammer"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-tools-line" title="Narzędzia">
                            <i class="ri-tools-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-hammer-line" title="Młotek 2">
                            <i class="ri-hammer-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-scissors-line" title="Nożyce">
                            <i class="ri-scissors-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-build" title="Budowa">
                            <i class="bx bx-build"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-hard-hat" title="Kask">
                            <i class="bx bx-hard-hat"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-ruler-line" title="Linijka">
                            <i class="ri-ruler-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-compass-line" title="Kompas">
                            <i class="ri-compass-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="ri-flashlight-line" title="Latarka">
                            <i class="ri-flashlight-line"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-outline-secondary icon-btn" data-icon="bx bx-folder" title="Folder">
                            <i class="bx bx-folder"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modification History -->
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="ri-time-line me-2"></i>Historia modyfikacji
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <div class="avatar-xs">
                                    <div class="avatar-title rounded-circle bg-success-subtle text-success">
                                        <i class="ri-add-line"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">Utworzona</h6>
                                <p class="text-muted mb-0">{{ category.createdAt|date('d.m.Y H:i') }}</p>
                            </div>
                        </div>
                    </div>

                    {% if category.updatedAt %}
                    <div class="col-lg-6">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <div class="avatar-xs">
                                    <div class="avatar-title rounded-circle bg-warning-subtle text-warning">
                                        <i class="ri-edit-line"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">Ostatnia modyfikacja</h6>
                                <p class="text-muted mb-0">{{ category.updatedAt|date('d.m.Y H:i') }}</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <a href="{{ path('app_tool_category_show', {id: category.id}) }}" class="btn btn-light">
                            <i class="ri-arrow-left-line me-1"></i> Wróć do podglądu
                        </a>
                        <a href="{{ path('app_tool_category_index') }}" class="btn btn-soft-secondary">
                            <i class="ri-list-line me-1"></i> Lista kategorii
                        </a>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="ri-save-line me-1"></i> Zapisz zmiany
                        </button>
                    </div>
                </div>
            </div>
        </div>

        {{ form_end(form) }}
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const iconInput = document.getElementById('icon-input');
    const iconPreview = document.getElementById('icon-preview');
    const iconButtons = document.querySelectorAll('.icon-btn');

    // Update icon preview when typing
    iconInput.addEventListener('input', function() {
        const iconClass = this.value.trim();
        iconPreview.className = iconClass || 'bx bx-folder';
    });

    // Icon gallery buttons
    iconButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const iconClass = this.dataset.icon;
            iconInput.value = iconClass;
            iconPreview.className = iconClass;
            
            // Update button states
            iconButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Highlight current icon if it matches any button
    const currentIcon = iconInput.value.trim();
    if (currentIcon) {
        iconButtons.forEach(button => {
            if (button.dataset.icon === currentIcon) {
                button.classList.add('active');
            }
        });
    }

    // Form validation
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
});
</script>

<style>
.icon-btn {
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.icon-btn:hover {
    background-color: var(--bs-secondary-bg);
}

.icon-btn.active {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
    color: white;
}
</style>
{% endblock %}